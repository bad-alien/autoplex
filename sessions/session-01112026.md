# Session Log: January 11, 2026

## Project Status
**Autoplex** is a Discord bot for Plex/Tautulli automation. 
*   **Current State:** Functional Local Development.
*   **Environment:** Python 3.11, Discord.py, running locally with Tailscale connectivity to Unraid.

## Accomplishments
1.  **Architecture Setup:**
    *   Created modular service structure: `src/services/plex_service.py`, `src/services/tautulli_service.py`.
    *   Configured `.env` handling and Logging.
2.  **Discord Bot Features:**
    *   `!plex usage`: Displays live stream stats from Tautulli.
    *   `!plex completion [artist] [user] [full]`: Calculates listening % for an artist.
        *   Features: Visual progress bars, Album breakdown (In-Progress vs Completed), Tautulli history integration.
    *   `!plex compare [artist] [user1] [user2]`: Side-by-side battle comparison of two users.
3.  **Key Fixes:**
    *   **RatingKey Mismatch:** Fixed type mismatch (int vs str) between Tautulli and Plex APIs.
    *   **Embed Limits:** Implemented dynamic field limits (18/6 albums) to stay under Discord's 25-field limit.
    *   **Tailscale:** Switched `.env` to use Tailscale IPs for connectivity.

## Configuration Notes
*   **Env Variables:**
    *   `PLEX_URL` / `TAUTULLI_URL` must use Tailscale IPs (`100.x.y.z`) if running off-network.
    *   `PLEX_TOKEN` must be the **Server Owner's** token.
*   **Tautulli:**
    *   History fetch limit set to **5000** items.
    *   Matches users by strict Username or Email.

## Current Modules
*   `src/main.py`: Bot entry point and command handlers.
*   `src/clients.py`: Singleton connections.
*   `src/config.py`: Environment loader.
*   `src/services/`: Business logic.

## Next Steps (ToDo)
1.  **Git Push:** Push local changes to `https://github.com/bad-alien/autoplex/`.
2.  **Test "Write" Features:**
    *   `!plex sync_top`: Verify it correctly creates/updates the "Top Rated" playlist.
    *   `!plex enrich`: Verify MusicBrainz lookup and Metadata writing.
3.  **Containerization:**
    *   Validate `Dockerfile`.
    *   Update `docker-compose.yml` for Unraid networking (Host mode vs Bridge).
4.  **Deployment:** Move to Unraid server.

## Pending Questions/Ideas
*   **Playlist Logic:** Should we add "Smart Playlists" or keep them Static?
*   **Metadata:** Expand enrichment beyond just Jazz albums?
